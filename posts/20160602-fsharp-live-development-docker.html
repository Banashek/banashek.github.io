<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../style.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="post.css" media="screen" />
    <title>Jonathan Banashek - Blog</title>
  </head>

  <body>
    <header>
      <h1>Jonathan Banashek</h1>
      <nav>
        <ul>
          <li><a href="https://www.github.com/banashek"><svg class="icon icon-github-square"><use xlink:href="#icon-github-square"></use></svg></a></li>
          <li><a href="../index.html">Blog</a></li>
          <li><a href="../portfolio.html">Portfolio</a></li>
	  	  <li><a href="../about.html">About</a></li>
          <li><a href="https://www.linkedin.com/pub/jonathan-banashek/30/409/758"><svg class="icon icon-linkedin-square"><use xlink:href="#icon-linkedin-square"></use></svg></a></li>
        </ul>
      </nav>
    </header>
    <hr>
    <main>
      <section>
		  <h2 class="title">Develop F# live in a Docker container</h2>
		  <p>
			  I think F# and Docker are both pretty cool technologies. 
			  Here is a way to create an awesome development environment with them.
		  </p>
		  <p>
			  Quick disclaimer:
			  <br/>
			  Here are the different versions of the software that I'm using:
			  <ul>
				  <li>OSX : 10.11.3 (15D21)</li>
				  <li>Docker : 1.11.1-beta13.1 (build: 8193)</li>
				  <li>Mono : (Stable 4.2.3.4/832de4b Wed Mar 30 13:57:48 PDT 2016)</li>
				  <li>Forge <i>via brew</i> : samritchie/forge/forge: stable 0.7.0</li>
			  </ul>
			  The finished code can be found <a href="https://github.com/Banashek/suavedockerdev">https://github.com/Banashek/suavedockerdev</a>
		  </p>
		  <h3>Project Scaffolding</h3>
		  <p>
			  To begin let's create a new directory, initialize our git repository, and create the new forge project.
		  </p>
		  <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">
<span style="color: #888888">projects %</span> mkdir suavedockerdev
<span style="color: #888888">projects %</span> cd suavedockerdev
<span style="color: #888888">suavedockerdev %</span> git init
<span style="color: #888888">suavedockerdev HEAD %</span> forge
<span style="color: #888888">Available commands:</span>

<span style="color: #888888">  new [-n]: Create new project</span>
<span style="color: #888888">  file [-f]: Adds or removes file from current folder and project.</span>
<span style="color: #888888">  reference [-ref]: Adds or removes reference from current project.</span>
<span style="color: #888888">  update: Updates Paket or FAKE</span>
<span style="color: #888888">  paket: Runs Paket</span>
<span style="color: #888888">  fake: Runs FAKE</span>
<span style="color: #888888">  refresh: Refreshes the template cache</span>
<span style="color: #888888">  help: Displays help</span>
<span style="color: #888888">  exit [quit|-q]: Exits interactive mode</span>

<span style="color: #888888">  --help [-h|/h|/help|/?]: display this list of options.</span>

<span style="color: #c65d09; font-weight: bold">&gt;</span> new
<span style="color: #888888">Enter project name:</span>
<span style="color: #c65d09; font-weight: bold">&gt;</span> sddweb
<span style="color: #888888">Enter project directory (relative to working directory):</span>
<span style="color: #c65d09; font-weight: bold">&gt;</span>
<span style="color: #888888">Choose a template:</span>
<span style="color: #888888"> - aspwebapi2</span>
<span style="color: #888888"> - classlib</span>
<span style="color: #888888"> - console</span>
<span style="color: #888888"> - fslabbasic</span>
<span style="color: #888888"> - fslabjournal</span>
<span style="color: #888888"> - pcl259</span>
<span style="color: #888888"> - servicefabrichost</span>
<span style="color: #888888"> - servicefabricsuavestateless</span>
<span style="color: #888888"> - sln</span>
<span style="color: #888888"> - suave</span>
<span style="color: #888888"> - suaveazurebootstrapper</span>
<span style="color: #888888"> - websharperserverclient</span>
<span style="color: #888888"> - websharperspa</span>
<span style="color: #888888"> - websharpersuave</span>
<span style="color: #888888"> - windows</span>

<span style="color: #c65d09; font-weight: bold">&gt;</span> console
<span style="color: #888888">Generating project...</span>
</pre></div>
		
		<p>
			Although there is a suave template, I chose to use the console library so that I could understand the basic pieces of F# and Suave before moving on to a pre-built template.
		</p>
		<p>
			Before you commit the generated project scaffolding, you can choose whether you want to add the packages folder to your gitignore file or not.
			Packaging compiled dependencies versus having declarative dependency files is a debate that is out of the scope of this post.
			I am going to choose to add it to the gitignore file so that the program will download the needed dependencies when the container is being built.
		</p>
		
<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">
<span style="color: #888888">suavedockerdev HEAD %</span> echo &quot;packages/&quot; &gt; .gitignore
<span style="color: #888888">suavedockerdev HEAD %</span> git add .
<span style="color: #888888">suavedockerdev HEAD %</span> git commit -m &quot;Initial commit of generated project&quot;
</pre></div>
		
		<p>
			If we want to run this new project we can simply build and then run the compiled executable located in the `build/` folder.
		</p>
		
		<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">
<span style="color: #888888">suavedockerdev master %</span> sh build.sh
<span style="color: #888888">suavedockerdev master %</span> mono build/sddweb.exe test
<span style="color: #888888">[|&quot;test&quot;|]</span>
</pre></div>

		<p>
			This is going to be a Suave app, so lets add in the dependency using forge (forge will automatically add the reference to the .fsproj file so we don't have to).
			We will also add in the FSharp.Compiler.Service dependency so that we can send updated files to be compiled and reload the application.
		</p>
		
		<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">
<span style="color: #888888">suavedockerdev master %</span> forge paket add nuget Suave project sddweb
<span style="color: #888888">suavedockerdev master %</span> forge paket add nuget FSharp.Compiler.Service project sddweb
</pre></div>


		<p>
			Now that we have our dependencies installed, we can move on to the core files that will enable us to do interactive development: app.fsx, build.fsx, the Dockerfile, and the docker-compose.yml file.
			<br/>
		</p>
		<p>
			The <b>app.fsx</b> file will live in the ssdweb/ folder and will be the entrypoint to our Suave application.
			<br />
			The <b>build.fsx</b> will be our FAKE build script responsible for watching the project directory for changes and restarting the application (app.fsx) when a file is changed.
			<br />
			The <b>Dockerfile</b> represents the steps required to build our application in a single docker container.
			<br />
			The <b>docker-compose.yml</b> file represents the file we will use to start up our application in docker-compose.
			Running our app via docker-compose will allow us to easily add containers for other useful services which our application can utilize to provide more functionality (think databases, cache servers, etc).
		</p>
		
		<h3>app.fsx</h3>
		
		<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #333333">#</span>r <span style="background-color: #fff0f0">&quot;../packages/Suave/lib/net40/Suave.dll&quot;</span>
<span style="color: #008800; font-weight: bold">open</span> <span style="color: #BB0066; font-weight: bold">Suave</span>
<span style="color: #008800; font-weight: bold">open</span> <span style="color: #0e84b5; font-weight: bold">Suave</span>.<span style="color: #BB0066; font-weight: bold">Successful</span>

<span style="color: #008800; font-weight: bold">let</span> app <span style="color: #333333">=</span> <span style="color: #BB0066; font-weight: bold">OK</span> <span style="background-color: #fff0f0">&quot;Hello Suave&quot;</span>
</pre></div>

		<p>
			app.fsx lives in the fsproj directory (`suavedockerdev/sddweb/app.fsx`) is just the hello world example from their website for now.
		</p>
		
		<h3>build.fsx</h3>
		
		<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #333333">#</span>r <span style="background-color: #fff0f0">&quot;./packages/FSharp.Compiler.Service/lib/net45/FSharp.Compiler.Service.dll&quot;</span>
<span style="color: #333333">#</span>r <span style="background-color: #fff0f0">&quot;./packages/Suave/lib/net40/Suave.dll&quot;</span>
<span style="color: #333333">#</span>r <span style="background-color: #fff0f0">&quot;./packages/FAKE/tools/FakeLib.dll&quot;</span>
<span style="color: #008800; font-weight: bold">open</span> <span style="color: #BB0066; font-weight: bold">Fake</span>
<span style="color: #008800; font-weight: bold">open</span> <span style="color: #BB0066; font-weight: bold">System</span>
<span style="color: #008800; font-weight: bold">open</span> <span style="color: #0e84b5; font-weight: bold">System</span>.<span style="color: #BB0066; font-weight: bold">Net</span>
<span style="color: #008800; font-weight: bold">open</span> <span style="color: #0e84b5; font-weight: bold">System</span>.<span style="color: #BB0066; font-weight: bold">IO</span>
<span style="color: #008800; font-weight: bold">open</span> <span style="color: #0e84b5; font-weight: bold">System</span>.<span style="color: #BB0066; font-weight: bold">Threading</span>
<span style="color: #008800; font-weight: bold">open</span> <span style="color: #BB0066; font-weight: bold">Suave</span>
<span style="color: #008800; font-weight: bold">open</span> <span style="color: #0e84b5; font-weight: bold">Suave</span>.<span style="color: #BB0066; font-weight: bold">Web</span>
<span style="color: #008800; font-weight: bold">open</span> <span style="color: #0e84b5; font-weight: bold">Microsoft</span>.<span style="color: #0e84b5; font-weight: bold">FSharp</span>.<span style="color: #0e84b5; font-weight: bold">Compiler</span>.<span style="color: #0e84b5; font-weight: bold">Interactive</span>.<span style="color: #BB0066; font-weight: bold">Shell</span>

<span style="color: #008800; font-weight: bold">let</span> sbOut <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0e84b5; font-weight: bold">Text</span>.<span style="color: #BB0066; font-weight: bold">StringBuilder</span><span style="color: #007020">()</span>
<span style="color: #008800; font-weight: bold">let</span> sbErr <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0e84b5; font-weight: bold">Text</span>.<span style="color: #BB0066; font-weight: bold">StringBuilder</span><span style="color: #007020">()</span>

<span style="color: #008800; font-weight: bold">let</span> fsiSession <span style="color: #333333">=</span>
  <span style="color: #008800; font-weight: bold">let</span> inStream <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> <span style="color: #BB0066; font-weight: bold">StringReader</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;&quot;</span><span style="color: #333333">)</span>
  <span style="color: #008800; font-weight: bold">let</span> outStream <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> <span style="color: #BB0066; font-weight: bold">StringWriter</span><span style="color: #333333">(</span>sbOut<span style="color: #333333">)</span>
  <span style="color: #008800; font-weight: bold">let</span> errStream <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> <span style="color: #BB0066; font-weight: bold">StringWriter</span><span style="color: #333333">(</span>sbErr<span style="color: #333333">)</span>
  <span style="color: #008800; font-weight: bold">let</span> fsiConfig <span style="color: #333333">=</span> <span style="color: #0e84b5; font-weight: bold">FsiEvaluationSession</span>.<span style="color: #BB0066; font-weight: bold">GetDefaultConfiguration</span><span style="color: #007020">()</span>
  <span style="color: #008800; font-weight: bold">let</span> argv <span style="color: #333333">=</span> <span style="color: #0e84b5; font-weight: bold">Array</span>.append <span style="color: #333333">[|</span><span style="background-color: #fff0f0">&quot;/fake/fsi.exe&quot;</span><span style="color: #333333">;</span> <span style="background-color: #fff0f0">&quot;--quiet&quot;</span><span style="color: #333333">;</span> <span style="background-color: #fff0f0">&quot;--noninteractive&quot;</span><span style="color: #333333">;</span> <span style="background-color: #fff0f0">&quot;-d:DO_NOT_START_SERVER&quot;</span><span style="color: #333333">|]</span> <span style="color: #333333">[||]</span>
  <span style="color: #0e84b5; font-weight: bold">FsiEvaluationSession</span>.<span style="color: #BB0066; font-weight: bold">Create</span><span style="color: #333333">(</span>fsiConfig<span style="color: #333333">,</span> argv<span style="color: #333333">,</span> inStream<span style="color: #333333">,</span> outStream<span style="color: #333333">,</span> errStream<span style="color: #333333">)</span>

<span style="color: #008800; font-weight: bold">let</span> reportFsiError <span style="color: #333333">(</span>e<span style="color: #333333">:</span>exn<span style="color: #333333">)</span> <span style="color: #333333">=</span>
  traceError <span style="background-color: #fff0f0">&quot;Reloading app.fsx script failed.&quot;</span>
  traceError <span style="color: #333333">(</span>sprintf <span style="background-color: #fff0f0">&quot;Message: %s</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\n</span><span style="background-color: #fff0f0">Error: %s&quot;</span> e<span style="color: #333333">.</span><span style="color: #BB0066; font-weight: bold">Message</span> <span style="color: #333333">(</span>sbErr<span style="color: #333333">.</span><span style="color: #BB0066; font-weight: bold">ToString</span><span style="color: #007020">()</span><span style="color: #333333">.</span><span style="color: #BB0066; font-weight: bold">Trim</span><span style="color: #007020">()</span><span style="color: #333333">))</span>
  sbErr<span style="color: #333333">.</span><span style="color: #BB0066; font-weight: bold">Clear</span><span style="color: #007020">()</span> <span style="color: #333333">|&gt;</span> ignore

<span style="color: #008800; font-weight: bold">let</span> reloadScript <span style="color: #007020">()</span> <span style="color: #333333">=</span>
  <span style="color: #008800; font-weight: bold">try</span>
    traceImportant <span style="background-color: #fff0f0">&quot;Reloading app.fsx script...&quot;</span>
    <span style="color: #008800; font-weight: bold">let</span> appFsx <span style="color: #333333">=</span> <span style="color: #333333">__</span>SOURCE_DIRECTORY__ <span style="color: #333333">@@</span> <span style="background-color: #fff0f0">&quot;/sddweb/app.fsx&quot;</span>
    fsiSession<span style="color: #333333">.</span><span style="color: #BB0066; font-weight: bold">EvalInteraction</span><span style="color: #333333">(</span>sprintf <span style="background-color: #fff0f0">&quot;#load @</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\&quot;</span><span style="background-color: #fff0f0">%s</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\&quot;</span><span style="background-color: #fff0f0">&quot;</span> appFsx<span style="color: #333333">)</span>
    fsiSession<span style="color: #333333">.</span><span style="color: #BB0066; font-weight: bold">EvalInteraction</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;open App&quot;</span><span style="color: #333333">)</span>
    <span style="color: #008800; font-weight: bold">match</span> fsiSession<span style="color: #333333">.</span><span style="color: #BB0066; font-weight: bold">EvalExpression</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;app&quot;</span><span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">with</span>
    <span style="color: #333333">|</span> <span style="color: #BB0066; font-weight: bold">Some</span> app <span style="color: #333333">-&gt;</span> <span style="color: #BB0066; font-weight: bold">Some</span><span style="color: #333333">(</span>app<span style="color: #333333">.</span><span style="color: #BB0066; font-weight: bold">ReflectionValue</span> <span style="color: #333333">:?&gt;</span> <span style="color: #BB0066; font-weight: bold">WebPart</span><span style="color: #333333">)</span>
    <span style="color: #333333">|</span> <span style="color: #BB0066; font-weight: bold">None</span> <span style="color: #333333">-&gt;</span> failwith <span style="background-color: #fff0f0">&quot;Couldn&#39;t get &#39;app&#39; value&quot;</span>
  <span style="color: #008800; font-weight: bold">with</span> e <span style="color: #333333">-&gt;</span> reportFsiError e<span style="color: #333333">;</span> <span style="color: #BB0066; font-weight: bold">None</span>

<span style="color: #008800; font-weight: bold">let</span> currentApp <span style="color: #333333">=</span> ref <span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">fun</span> <span style="color: #333333">_</span> <span style="color: #333333">-&gt;</span> async <span style="color: #333333">{</span> <span style="color: #008800; font-weight: bold">return</span> <span style="color: #BB0066; font-weight: bold">None</span> <span style="color: #333333">})</span>

<span style="color: #008800; font-weight: bold">let</span> serverConfig <span style="color: #333333">=</span>
  <span style="color: #333333">{</span> defaultConfig <span style="color: #008800; font-weight: bold">with</span>
      homeFolder <span style="color: #333333">=</span> <span style="color: #BB0066; font-weight: bold">Some</span> <span style="color: #333333">__</span>SOURCE_DIRECTORY__
      logger <span style="color: #333333">=</span> <span style="color: #0e84b5; font-weight: bold">Logging</span>.<span style="color: #0e84b5; font-weight: bold">Loggers</span>.saneDefaultsFor <span style="color: #0e84b5; font-weight: bold">Logging</span>.<span style="color: #0e84b5; font-weight: bold">LogLevel</span>.<span style="color: #BB0066; font-weight: bold">Debug</span>
      bindings <span style="color: #333333">=</span> <span style="color: #333333">[</span> <span style="color: #0e84b5; font-weight: bold">HttpBinding</span>.mk <span style="color: #BB0066; font-weight: bold">HTTP</span> <span style="color: #333333">(</span><span style="color: #0e84b5; font-weight: bold">IPAddress</span>.<span style="color: #BB0066; font-weight: bold">Parse</span> <span style="background-color: #fff0f0">&quot;0.0.0.0&quot;</span><span style="color: #333333">)</span> <span style="color: #0000DD; font-weight: bold">8083</span>us<span style="color: #333333">]</span> <span style="color: #333333">}</span>

<span style="color: #008800; font-weight: bold">let</span> reloadAppServer <span style="color: #333333">(</span>changedFiles<span style="color: #333333">:</span> <span style="color: #333399; font-weight: bold">string</span> seq<span style="color: #333333">)</span> <span style="color: #333333">=</span>
  traceImportant <span style="color: #333333">&lt;|</span> sprintf <span style="background-color: #fff0f0">&quot;Changes in %s&quot;</span> <span style="color: #333333">(</span><span style="color: #0e84b5; font-weight: bold">String</span>.<span style="color: #BB0066; font-weight: bold">Join</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;,&quot;</span><span style="color: #333333">,</span>changedFiles<span style="color: #333333">))</span>
  reloadScript<span style="color: #007020">()</span> <span style="color: #333333">|&gt;</span> <span style="color: #0e84b5; font-weight: bold">Option</span>.iter <span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">fun</span> app <span style="color: #333333">-&gt;</span>
    currentApp<span style="color: #333333">.</span><span style="color: #BB0066; font-weight: bold">Value</span> <span style="color: #333333">&lt;-</span> app
    traceImportant <span style="background-color: #fff0f0">&quot;Refreshed app.&quot;</span> <span style="color: #333333">)</span>

<span style="color: #BB0066; font-weight: bold">Target</span> <span style="background-color: #fff0f0">&quot;run&quot;</span> <span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">fun</span> <span style="color: #333333">_</span> <span style="color: #333333">-&gt;</span>
  <span style="color: #008800; font-weight: bold">let</span> app ctx <span style="color: #333333">=</span> currentApp<span style="color: #333333">.</span><span style="color: #BB0066; font-weight: bold">Value</span> ctx
  <span style="color: #008800; font-weight: bold">let</span> <span style="color: #333333">_,</span> server <span style="color: #333333">=</span> startWebServerAsync serverConfig app

  <span style="color: #888888">// Start Suave to host it on localhost</span>
  reloadAppServer <span style="color: #333333">[</span><span style="background-color: #fff0f0">&quot;app.fsx&quot;</span><span style="color: #333333">]</span>
  <span style="color: #0e84b5; font-weight: bold">Async</span>.<span style="color: #BB0066; font-weight: bold">Start</span><span style="color: #333333">(</span>server<span style="color: #333333">)</span>

  <span style="color: #888888">// Watch for changes &amp; reload when app.fsx changes</span>
  <span style="color: #008800; font-weight: bold">let</span> sources <span style="color: #333333">=</span> 
    <span style="color: #333333">{</span> <span style="color: #BB0066; font-weight: bold">BaseDirectory</span> <span style="color: #333333">=</span> <span style="color: #333333">__</span>SOURCE_DIRECTORY__
      <span style="color: #BB0066; font-weight: bold">Includes</span> <span style="color: #333333">=</span> <span style="color: #333333">[</span> <span style="background-color: #fff0f0">&quot;**/*.fsx&quot;</span><span style="color: #333333">;</span> <span style="background-color: #fff0f0">&quot;**/*.fs&quot;</span> <span style="color: #333333">;</span> <span style="background-color: #fff0f0">&quot;**/*.fsproj&quot;</span><span style="color: #333333">;</span> <span style="color: #333333">];</span> 
      <span style="color: #BB0066; font-weight: bold">Excludes</span> <span style="color: #333333">=</span> <span style="color: #007020">[]</span> <span style="color: #333333">}</span>

  <span style="color: #008800; font-weight: bold">use</span> watcher <span style="color: #333333">=</span> sources <span style="color: #333333">|&gt;</span> <span style="color: #BB0066; font-weight: bold">WatchChanges</span> <span style="color: #333333">(</span><span style="color: #0e84b5; font-weight: bold">Seq</span>.map <span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">fun</span> x <span style="color: #333333">-&gt;</span> x<span style="color: #333333">.</span><span style="color: #BB0066; font-weight: bold">FullPath</span><span style="color: #333333">)</span> <span style="color: #333333">&gt;&gt;</span> reloadAppServer<span style="color: #333333">)</span>
  traceImportant <span style="background-color: #fff0f0">&quot;Waiting for app.fsx edits. Press any key to stop.&quot;</span>
  <span style="color: #888888">// Hold thread open so that docker doesn&#39;t close the process when it detaches in compose</span>
  <span style="color: #0e84b5; font-weight: bold">Thread</span>.<span style="color: #BB0066; font-weight: bold">Sleep</span><span style="color: #333333">(-</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">)</span>
<span style="color: #333333">)</span>

<span style="color: #BB0066; font-weight: bold">RunTargetOrDefault</span> <span style="background-color: #fff0f0">&quot;run&quot;</span>
</pre></div>

		
		<p>
			build.fsx lives in the top level directory (`suavedockerdev/build.fsx`) and is the core of how the hot-reloading of our application works.
		</p>
		<p>
			While other languages have their own programs for hot-reloading changed files (nodemon for node, dotnet-watch for .net core, etc), this is
			 something that is written by hand in our build script.
		</p>
		<p>
			This file is mostly taken from Tomas Petricek's found here: <a href="https://github.com/tpetricek/suave-xplat-gettingstarted/blob/master/build.fsx">https://github.com/tpetricek/suave-xplat-gettingstarted/blob/master/build.fsx</a>
			Not only did he create the base for this file, but also helped me figure out how to get it working in docker-compose!
		</p>
		<p>
			This file works by doing a few things:
		</p>
		<p>
			First it sets up a F# compiler service session named `fsiSession`.
			This allows us to send changed code to be compiled on a different thread and returned to us in it's final form.
		</p>
		<p>
			It then creates the `reportFsiError` helper function for writing errors to output should there be an issue.
		</p>
		<p>
			Next it defines the `reloadScript` function.
			This function defines `appFsx` to represent the app.fsx file. If your file is in a different location, make sure this is pointing to the correct spot!
			It uses the `EvalInteraction` and `EvalExpression` to re-evaluate the app.fsx file. It's basically a hand made repl for your app.fsx file.
		</p>
		<p>
			`currentApp` is defined as a mutable (ref) placeholder for your app so that once the compiler service evaluates your new interpereted app.fsx file, 
			that it can re-assign the value of `currentApp` to the result of the evaluation.
		</p>
		<p>
			`serverConfig` is then defined with a few differentiations from the Suave default config. One special thing to note here is that I used the ip `0.0.0.0`.
			Docker by default binds all available interfaces (INADDR_ANY) at the address 0.0.0.0 unless configured to do otherwise. 
			I wanted to leave that alone, so I just made the change in the build file.
		</p>
		<p>
			The `reloadAppServer` function comes next.
			It takes the sequence of changed files, logs a message, calls the `reloadScript` function, then swaps in the new app value. 
		</p>
		<p>
			The last piece of this script is the actual build target.
			This is what is called when FAKE is executed by the `build.sh` script.
			First it calls an initial `reloadAppServer` with the app.fsx file.
			It then starts the server asynchronously with the initial value returned.
			Next it sets the source directories variable to include .fs, .fsx, and .fsproj files to be watched.
			Once the directories are set, it creates a `System.IO.FileSystemWatcher` and calls the `WatchChanges` method to watch those files for changes,
			composing the `reloadAppServer` function on to the end to be called whenever a file changes.
			It then calls `Thread.Sleep(-1)` to hold the thread open so that when the application is run in a detatched container (docker-compose) that it continues to keep the process open.
		</p>
		
		<h3>Local Live Editing</h3>
		
		<p>
			With these two files in place, you should now be able to live edit your web server code.
		</p>
		<p>
			To do this open up two terminals. In the first terminal run `sh build.sh` from the projects root directory.
			The output should look something like this:
		</p>
		
		<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #888888">suavedockerdev master %</span> sh build.sh
<span style="color: #888888">No version specified. Downloading latest stable.</span>
<span style="color: #888888">Paket.exe 2.66.8.0 is up to date.</span>
<span style="color: #888888">Paket version 2.66.8.0</span>
<span style="color: #888888">0 seconds - ready.</span>
<span style="color: #888888">Building project with version: LocalBuild</span>
<span style="color: #888888">Shortened DependencyGraph for Target run:</span>
<span style="color: #888888">&lt;== run</span>

<span style="color: #888888">The resulting target order is:</span>
<span style="color: #888888"> - run</span>
<span style="color: #888888">Starting Target: run</span>
<span style="color: #888888">Changes in app.fsx</span>
<span style="color: #888888">Reloading app.fsx script...</span>
<span style="color: #888888">Refreshed app.</span>
<span style="color: #888888">dirs to watch: [&quot;/Users/jonbanashek/Projects/fs/suavedockerdev&quot;;</span>
<span style="color: #888888"> &quot;/Users/jonbanashek/Projects/fs/suavedockerdev&quot;;</span>
<span style="color: #888888"> &quot;/Users/jonbanashek/Projects/fs/suavedockerdev&quot;]</span>
<span style="color: #888888">watching dir: /Users/jonbanashek/Projects/fs/suavedockerdev</span>
<span style="color: #888888">[I] 2016-06-02T23:47:35.6877090Z: listener started in 972.925 ms with binding 0.0.0.0:8083 [Suave.Tcp.tcpIpServer]</span>
<span style="color: #888888">watching dir: /Users/jonbanashek/Projects/fs/suavedockerdev</span>
<span style="color: #888888">watching dir: /Users/jonbanashek/Projects/fs/suavedockerdev</span>
<span style="color: #888888">Waiting for app.fsx edits. Press any key to stop.</span>
</pre></div>

		<p>
			Now in your second terminal, you should be able to run curl to see the output.
		</p>
		
		<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #888888">suavedockerdev master %</span> curl localhost:8083
<span style="color: #888888">Hello Suave</span>
</pre></div>

		<p>
			Now in whatever editor you're using, go and change the string in the `app.fsx` file to "Hello Suave Interactive!"
		</p>
		
		<p>
			If you go back to the first terminal, you should see output indicating that the watcher process noticed the file change and reloaded the application.
		</p>
		
		<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #888888">Changes in /Users/jonbanashek/Projects/fs/suavedockerdev/sddweb/app.fsx</span>
<span style="color: #888888">Reloading app.fsx script...</span>
<span style="color: #888888">Refreshed app.</span>
</pre></div>

		<p>
			And if we run curl again we should see the new output!
		</p>
		
		<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #888888">suavedockerdev master %</span> curl localhost:8083
<span style="color: #888888">Hello Suave Interactive!</span>
</pre></div>

		<h3>Setting up Docker for in-container development</h3>
		
		<p>
			Live-reloading of an app is cool, but that could break if I tried it on a friend's machine who has an old copy of xamarin, unity3d, brew, and 3 other versions of mono linked in weird ways which they forgot about and have never gone back to check on since they never use it themselves and all the apps that need it are working at the moment.
			It would be pretty sweet if I could tell them that all they needed to do to start playing around with the project was `git clone` and a `docker run` command.
			I would also sleep easy knowing that any other places I would run it (CI server, Azure, AWS, DigitalOcean, etc) would have the same output.
			So let's get this working in docker.
		</p>
		
		<p>
			All that we need to do is create a Dockerfile and pass some parameters to the `docker run` command to get this to work.
			To be fair, we did do a little bit of setup earlier with the specific IP address and Thread.Sleep call that were in the `build.fsx` file.
		</p>
		
		<h3>
			The Dockerfile
		</h3>
		
		<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">FROM fsharp<span style="color: #333333">/</span>fsharp<span style="color: #333333">:</span>latest
COPY . <span style="color: #333333">/</span>app<span style="color: #333333">/</span>
WORKDIR <span style="color: #333333">/</span>app
EXPOSE <span style="color: #0000DD; font-weight: bold">8083</span>
CMD [<span style="background-color: #fff0f0">&quot;/bin/bash&quot;</span>, <span style="background-color: #fff0f0">&quot;build.sh&quot;</span>]
</pre></div>

		<p>
			The Dockerfile is pretty simple.
		</p>
		<p>It uses the fsharp image as it's base (which takes care of making sure mono and other fsharp dependencies are present)</p>
		<p>Then it copies the application code over to the `/app/` directory of the container (absolute path).</p>
		<p>The `WORKDIR` command changes the directory into the copied application directory.</p>
		<p>We `EXPOSE` the 8083 port from the container to the container host so that there is a way to communicate with the application.</p>
		<p>Finally we run our same build script as the entrypoint into our docker container.</p>
		
		<h3>Docker Interactive</h3>
		<p>Now that the docker file is set up we can do the same 2 terminal setup from earlier.</p>
		<p>First let's build the container into a container image that docker can run. We'll also give it a tag with a specific version so that we can keep track of our image.</p>
		
		<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #888888">suavedockerdev master %</span> docker build -t sdd:0.1 .
<span style="color: #888888">Sending build context to Docker daemon 166.4 MB</span>
<span style="color: #888888">Step 1 : FROM fsharp/fsharp:latest</span>
<span style="color: #888888"> ---&gt; 73ffae16882d</span>
<span style="color: #888888">Step 2 : COPY . /app/</span>
<span style="color: #888888"> ---&gt; 54e8bfacda51</span>
<span style="color: #888888">Removing intermediate container e5aee6cb48ad</span>
<span style="color: #888888">Step 3 : WORKDIR /app</span>
<span style="color: #888888"> ---&gt; Running in 79d24650eb26</span>
<span style="color: #888888"> ---&gt; f38224a4e00c</span>
<span style="color: #888888">Removing intermediate container 79d24650eb26</span>
<span style="color: #888888">Step 4 : EXPOSE 8083</span>
<span style="color: #888888"> ---&gt; Running in c3eebcac1cdb</span>
<span style="color: #888888"> ---&gt; 13ab455b1004</span>
<span style="color: #888888">Removing intermediate container c3eebcac1cdb</span>
<span style="color: #888888">Step 5 : CMD /bin/bash build.sh</span>
<span style="color: #888888"> ---&gt; Running in a16513b815b7</span>
<span style="color: #888888"> ---&gt; 198818469fe1</span>
<span style="color: #888888">Removing intermediate container a16513b815b7</span>
<span style="color: #888888">Successfully built 198818469fe1</span>
</pre></div>

		<p>
			Now that we have a container image built we can run the docker image in terminal 1.
		</p>
		
		<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #888888">suavedockerdev master %</span> docker run -it --rm -v `pwd`:/app -p 8083:8083 sdd:0.1
<span style="color: #888888">No version specified. Downloading latest stable.</span>
<span style="color: #888888">Paket.exe 2.66.8.0 is up to date.</span>
<span style="color: #888888">Paket version 2.66.8.0</span>
<span style="color: #888888">Downloading FAKE 4.28</span>
<span style="color: #888888">Downloading FSharp.Compiler.Service 3.0</span>
<span style="color: #888888">Downloading FSharp.Core 4.0.0.1</span>
<span style="color: #888888">Downloading Suave 1.1.2</span>
<span style="color: #888888">12 seconds - ready.</span>
<span style="color: #888888">Building project with version: LocalBuild</span>
<span style="color: #888888">Shortened DependencyGraph for Target run:</span>
<span style="color: #888888">&lt;== run</span>

<span style="color: #888888">The resulting target order is:</span>
<span style="color: #888888"> - run</span>
<span style="color: #888888">Starting Target: run</span>
<span style="color: #888888">Changes in app.fsx</span>
<span style="color: #888888">Reloading app.fsx script...</span>
<span style="color: #888888">Refreshed app.</span>
<span style="color: #888888">dirs to watch: [&quot;/app&quot;; &quot;/app&quot;; &quot;/app&quot;]</span>
<span style="color: #888888">watching dir: /app</span>
<span style="color: #888888">[I] 2016-06-03T01:45:10.3901380Z: listener started in 1674.804 ms with binding 0.0.0.0:8083 [Suave.Tcp.tcpIpServer]</span>
<span style="color: #888888">watching dir: /app</span>
<span style="color: #888888">watching dir: /app</span>
<span style="color: #888888">Waiting for app.fsx edits. Press any key to stop.</span>
</pre></div>

		<p> This docker command has a few parameters which are important:</p>
		<ul>
			<li><b>-it</b> gives us an interactive terminal so that we can interact with the running application. 
				This is opposite of a detached container, where the image runs in the background until the process ends.</li>
			<li><b>`--rm`</b> removes the container in which the image is run after the process ends.
				I included this flag as more of a convenience so that I don't have to clean up a bunch of unused containers later.
			</li>
			<li>
				<b>-v `pwd`:/app</b> is the what makes the live-reloading work even in the docker container.
				By default, when docker builds an image, it compresses the copied directories and uncompresses them in the container.
				This makes it so that the files are actually different files than the files on your local directory.
				The <b> -v </b> command overlays a directory onto a containers directory so that when docker runs, it sees that directory instead.
				Since the container sees our local directory, it will correctly notice when a file changes and reloads the app.
				If we did not use this option, the file watcher would be watching the compressed->decompressed files that were created when the image was built instead of the files we edit locally on our computer.
			</li>
			<li>
				<b>-p</b> forwards a port from the docker container to the docker host. This is what allows us to communicate with the docker container via `localhost:8083`.
			</li>
		</ul>
		
		<p>
			If you go do the curl->edit->curl test, you should see that you can now interactively develop inside of a reusable docker container!
		</p>
		
		<h3>Live Editing in Docker Compose</h3>
		
		<p>
			Docker itself gives us a utility for reliable code execution. 
			Docker compose takes that up a level to wire multiple docker containers together to allow you to bring up a reliable infrastucture.
			First we'll create the docker-compose.yml file that will allow us to live-edit in docker compose, and then we'll see how docker compose allows us to easily add other utilities to our applications infrastructure.
		</p>
		
		<h3>docker-compose.yml</h3>
		
		<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #996633">web:</span>
  <span style="color: #996633">build: </span>.
  <span style="color: #996633">working_dir: </span><span style="color: #333333">/</span>app
  <span style="color: #996633">ports:</span>
    <span style="color: #333333">-</span> <span style="background-color: #fff0f0">&quot;8083:8083&quot;</span>
  <span style="color: #996633">volumes:</span>
    <span style="color: #333333">-</span> .<span style="color: #333333">:/</span>app
</pre></div>

		<p>
			This file declares a volume `web` which is built from the current directory, and then passes the same parameters that we were passing when running `docker run`.
		</p>
		
		<p>Run `docker-compose up` to pull up our container.</p>
		
		<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #888888">suavedockerdev master %</span> docker-compose up
<span style="color: #888888">Building web</span>
<span style="color: #888888">Step 1 : FROM fsharp/fsharp:latest</span>
<span style="color: #888888"> ---&gt; 73ffae16882d</span>
<span style="color: #888888">Step 2 : COPY . /app/</span>
<span style="color: #888888"> ---&gt; a93621673380</span>
<span style="color: #888888">Removing intermediate container 4d74d0de4a28</span>
<span style="color: #888888">Step 3 : WORKDIR /app</span>
<span style="color: #888888"> ---&gt; Running in 4114058dd792</span>
<span style="color: #888888"> ---&gt; ef52c5f3b7d8</span>
<span style="color: #888888">Removing intermediate container 4114058dd792</span>
<span style="color: #888888">Step 4 : EXPOSE 8083</span>
<span style="color: #888888"> ---&gt; Running in 91a922a5aff6</span>
<span style="color: #888888"> ---&gt; ce5eefc7f3f9</span>
<span style="color: #888888">Removing intermediate container 91a922a5aff6</span>
<span style="color: #888888">Step 5 : CMD /bin/bash build.sh</span>
<span style="color: #888888"> ---&gt; Running in d417522b6b05</span>
<span style="color: #888888"> ---&gt; 17f760a72dfb</span>
<span style="color: #888888">Removing intermediate container d417522b6b05</span>
<span style="color: #888888">Successfully built 17f760a72dfb</span>
<span style="color: #888888">WARNING: Image for service web was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`.</span>
<span style="color: #888888">Creating suavedockerdev_web_1</span>
<span style="color: #888888">Attaching to suavedockerdev_web_1</span>
<span style="color: #888888">web_1  | No version specified. Downloading latest stable.</span>
<span style="color: #888888">web_1  | Paket.exe 2.66.8.0 is up to date.</span>
<span style="color: #888888">web_1  | Paket version 2.66.8.0</span>
<span style="color: #888888">web_1  | Downloading FAKE 4.28</span>
<span style="color: #888888">web_1  | Downloading FSharp.Compiler.Service 3.0</span>
<span style="color: #888888">web_1  | Downloading FSharp.Core 4.0.0.1</span>
<span style="color: #888888">web_1  | Downloading Suave 1.1.2</span>
<span style="color: #888888">web_1  | 14 seconds - ready.</span>
<span style="color: #888888">web_1  | Building project with version: LocalBuild</span>
<span style="color: #888888">web_1  | Shortened DependencyGraph for Target run:</span>
<span style="color: #888888">web_1  | &lt;== run</span>
<span style="color: #888888">web_1  |</span>
<span style="color: #888888">web_1  | The resulting target order is:</span>
<span style="color: #888888">web_1  |  - run</span>
<span style="color: #888888">web_1  | Starting Target: run</span>
<span style="color: #888888">web_1  | Changes in app.fsx</span>
<span style="color: #888888">web_1  | Reloading app.fsx script...</span>
<span style="color: #888888">web_1  | Refreshed app.</span>
<span style="color: #888888">web_1  | dirs to watch: [&quot;/app&quot;; &quot;/app&quot;; &quot;/app&quot;]</span>
<span style="color: #888888">web_1  | watching dir: /app</span>
<span style="color: #888888">web_1  | [I] 2016-06-03T02:41:09.2202990Z: listener started in 1425.439 ms with binding 0.0.0.0:8083 [Suave.Tcp.tcpIpServer]</span>
<span style="color: #888888">web_1  | watching dir: /app</span>
<span style="color: #888888">web_1  | watching dir: /app</span>
<span style="color: #888888">web_1  | Waiting for app.fsx edits. Press any key to stop.</span>
</pre></div>

		
		<p>
			Once more curl->edit->curl and see that we're good to go.
		</p>
		
		<h3>Reaping the rewards</h3>
		
		<p>
			We could have settled with the local live-editing for developing our Suave application, but we decided to get it set up in docker compose with some extra work.
		</p>
		
		<p>Let's see how easy it is to add a redis box to our development environment.</p>
		
		<h3>docker-compose.yml</h3>
		
		<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #996633">web:</span>
  <span style="color: #996633">build: </span>.
  <span style="color: #996633">links:</span>
    <span style="color: #333333">-</span> redis<span style="color: #333333">:</span>redis
  <span style="color: #996633">working_dir: </span><span style="color: #333333">/</span>app
  <span style="color: #996633">ports:</span>
    <span style="color: #333333">-</span> <span style="background-color: #fff0f0">&quot;8083:8083&quot;</span>
  <span style="color: #996633">volumes:</span>
    <span style="color: #333333">-</span> .<span style="color: #333333">:/</span>app

<span style="color: #996633">redis:</span>
  <span style="color: #996633">restart: </span>always
  <span style="color: #996633">image: </span>redis<span style="color: #333333">:</span>latest
  <span style="color: #996633">ports:</span>
    <span style="color: #333333">-</span> <span style="background-color: #fff0f0">&quot;6379:6379&quot;</span>
  <span style="color: #996633">volumes:</span>
    <span style="color: #333333">-</span> redisdata<span style="color: #333333">:/</span>data
</pre></div>

		<p>That's it, we can just run `docker-compose up` again and now our Suave app has a redis app which it can communicate with.</p>
		
		<p>Now eventually we will want to have another build target so that we have something that can run in production, but this works for fleshing out ideas for now.</p>
		
		<p>Thanks to Tomas Petricek and Reed Copsey, Jr. for the help they provided over on the #fsharp-beginners channel of the functionalprogramming slack!</p>
		
      </section>
    </main>
  </body>

  <svg style="position: absolute; width: 0; height: 0;" width="0" height="0" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <defs>
      <symbol id="icon-linkedin-square" viewBox="0 0 24 28">
	<title>linkedin-square</title>
	<path class="path1" d="M3.703 22.094h3.609v-10.844h-3.609v10.844zM7.547 7.906q-0.016-0.812-0.562-1.344t-1.453-0.531-1.477 0.531-0.57 1.344q0 0.797 0.555 1.336t1.445 0.539h0.016q0.922 0 1.484-0.539t0.562-1.336zM16.688 22.094h3.609v-6.219q0-2.406-1.141-3.641t-3.016-1.234q-2.125 0-3.266 1.828h0.031v-1.578h-3.609q0.047 1.031 0 10.844h3.609v-6.062q0-0.594 0.109-0.875 0.234-0.547 0.703-0.93t1.156-0.383q1.813 0 1.813 2.453v5.797zM24 6.5v15q0 1.859-1.32 3.18t-3.18 1.32h-15q-1.859 0-3.18-1.32t-1.32-3.18v-15q0-1.859 1.32-3.18t3.18-1.32h15q1.859 0 3.18 1.32t1.32 3.18z"></path>
      </symbol>
      <symbol id="icon-github-square" viewBox="0 0 24 28">
	<title>github-square</title>
	<path class="path1" d="M8.109 18.75q0.063-0.094-0.047-0.203-0.141-0.109-0.219-0.031-0.063 0.094 0.047 0.203 0.141 0.109 0.219 0.031zM7.672 18.109q-0.078-0.109-0.187-0.063-0.094 0.063 0 0.187 0.109 0.125 0.187 0.078 0.094-0.063 0-0.203zM7.031 17.484q0.031-0.063-0.078-0.125-0.109-0.031-0.125 0.031-0.047 0.078 0.063 0.125 0.125 0.031 0.141-0.031zM7.359 17.844q0.031-0.016 0.023-0.070t-0.055-0.086q-0.094-0.109-0.156-0.047t0.016 0.172q0.094 0.094 0.172 0.031zM8.703 19.016q0.031-0.109-0.141-0.172-0.141-0.047-0.203 0.063-0.031 0.109 0.141 0.172 0.141 0.047 0.203-0.063zM9.359 19.063q0-0.125-0.187-0.125-0.156 0-0.156 0.125t0.172 0.125 0.172-0.125zM9.969 18.953q-0.031-0.109-0.203-0.078t-0.141 0.141q0.031 0.125 0.187 0.094t0.156-0.156zM20 14q0-3.313-2.344-5.656t-5.656-2.344-5.656 2.344-2.344 5.656q0 2.609 1.531 4.695t3.938 2.898q0.281 0.047 0.414-0.078t0.133-0.313q0-0.812-0.016-1.484-0.094 0.016-0.242 0.039t-0.555 0.031-0.75-0.063-0.68-0.313-0.461-0.648q-0.359-0.922-0.891-1.156-0.031-0.016-0.070-0.055l-0.125-0.125t-0.109-0.148 0.063-0.117 0.305-0.055q0.094 0 0.234 0.031t0.469 0.242 0.516 0.555q0.25 0.438 0.586 0.656t0.68 0.219 0.594-0.055 0.469-0.148q0.109-0.734 0.516-1.078-0.766-0.094-1.344-0.289t-1.141-0.609-0.867-1.188-0.305-1.867q0-1.234 0.828-2.141-0.375-0.969 0.078-2.125 0.297-0.094 0.852 0.117t0.945 0.461l0.406 0.25q0.906-0.266 2-0.266t2 0.266q0.172-0.109 0.445-0.281t0.867-0.406 0.891-0.141q0.453 1.156 0.078 2.125 0.828 0.906 0.828 2.141 0 0.891-0.219 1.57t-0.555 1.094-0.836 0.695-0.977 0.406-1.070 0.187q0.547 0.484 0.547 1.484 0 0.625-0.008 1.391t-0.008 0.797q0 0.187 0.133 0.313t0.414 0.078q2.406-0.812 3.938-2.898t1.531-4.695zM24 6.5v15q0 1.859-1.32 3.18t-3.18 1.32h-15q-1.859 0-3.18-1.32t-1.32-3.18v-15q0-1.859 1.32-3.18t3.18-1.32h15q1.859 0 3.18 1.32t1.32 3.18z"></path>
      </symbol>
    </defs>
  </svg>
</html>
